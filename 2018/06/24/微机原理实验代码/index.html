<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="显示一段以$结尾字符串;利用9号功能调用显示 DATA    SEGMENT MESS    DB &amp;quot;HELLO$&amp;quot; DATA    ENDS  CODE    SEGMENT ASSUME    CS:CODE,DS:DATA  START: MOV AX,DATA MOV    DX,AX LEA    DX,MESS MOV    AH,9 INT    21H MOV">
<meta property="og:type" content="article">
<meta property="og:title" content="微机实验代码">
<meta property="og:url" content="http://yoursite.com/2018/06/24/微机原理实验代码/index.html">
<meta property="og:site_name" content="Jason&#39;s sky">
<meta property="og:description" content="显示一段以$结尾字符串;利用9号功能调用显示 DATA    SEGMENT MESS    DB &amp;quot;HELLO$&amp;quot; DATA    ENDS  CODE    SEGMENT ASSUME    CS:CODE,DS:DATA  START: MOV AX,DATA MOV    DX,AX LEA    DX,MESS MOV    AH,9 INT    21H MOV">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-06-24T07:55:26.972Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微机实验代码">
<meta name="twitter:description" content="显示一段以$结尾字符串;利用9号功能调用显示 DATA    SEGMENT MESS    DB &amp;quot;HELLO$&amp;quot; DATA    ENDS  CODE    SEGMENT ASSUME    CS:CODE,DS:DATA  START: MOV AX,DATA MOV    DX,AX LEA    DX,MESS MOV    AH,9 INT    21H MOV">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/06/24/微机原理实验代码/"/>





  <title>微机实验代码 | Jason's sky</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason's sky</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">everbodyup</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/24/微机原理实验代码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王嘉熙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason's sky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">微机实验代码</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-24T11:25:00+08:00">
                2018-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/06/24/微机原理实验代码/" class="leancloud_visitors" data-flag-title="微机实验代码">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  975
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="显示一段以-结尾字符串"><a href="#显示一段以-结尾字符串" class="headerlink" title="显示一段以$结尾字符串"></a>显示一段以$结尾字符串</h1><pre><code>;利用9号功能调用显示
DATA    SEGMENT
MESS    DB &quot;HELLO$&quot;
DATA    ENDS

CODE    SEGMENT
ASSUME    CS:CODE,DS:DATA

START:
MOV AX,DATA
MOV    DX,AX
LEA    DX,MESS
MOV    AH,9
INT    21H
MOV    AH,4CH
INT    21H
CODE    ENDS
END    START
</code></pre><h1 id="实现加法运算"><a href="#实现加法运算" class="headerlink" title="实现加法运算"></a>实现加法运算</h1><pre><code>;转换BCD输出，十进制字符加32
CODE    SEGMENT
START:
MOV AH,00H
MOV    AL,11H
MOV    BL,1BH
ADD    AL,BL
MOV CH,0AH
CBW
IDIV
MOV    BL,AH
OR    AL,30H
MOV    DX,AL
MOV    AH,02H
INT    21H
MOV    AH,BL
MOV DX,AH
MOV    AH,02H
INT    21H
MOV    AH,4CH
INT    21H
CODE    ENDS
END    START
</code></pre><h1 id="8255控制LED灯"><a href="#8255控制LED灯" class="headerlink" title="8255控制LED灯"></a>8255控制LED灯</h1><pre><code>;A口输入B口输出C口置0
CODE    SEGMENT
ASSUME    CS:CODE
MOV DX,283H
MOV    AL,10010000B
OUT    DX,AL

TEST_IT:
MOV    DX,280H
IN    AL,DX
MOV    DX,281H
OUT    AL,DX
JMP    TEST_IT
MOV AH,4CH
INT    21H
CODE    ENDS
END    START
</code></pre><h1 id="基于8253和8255的跑马灯"><a href="#基于8253和8255的跑马灯" class="headerlink" title="基于8253和8255的跑马灯"></a>基于8253和8255的跑马灯</h1><pre><code>8253级联方式; 选择通道0方式2作为第一次输入（负脉冲），选择通道1方式3作为第二次输入（方波）
8255 A口输入，B口输出，C口延时输入

CODE SEGMENT
ASSUME CS:CODE

;8253初始化
MOV DX, 283H
MOV AL, 00110101B ;通道0方式2控制口送控制字
OUT DX, AL
MOV DX, 280H 
MOV AL, 00H   ;A输入口送低字节    
OUT DX, AL
MOV AL, 10H   ;A输入口送高字节
OUT DX, AL

MOV DX, 283H
MOV AL, 01110111B ;通道1方式3控制口送控制字
OUT DX, AL
MOV DX, 281H
MOV AL, 00H  ;B输出口送低字节
OUT DX, AL
MOV AL, 10H     ;B输出口送高字节
OUT DX, AL

;8255初始化
MOV DX,28BH
MOV AL,10000000B ;A口输入B口输出C口延时输入
OUT DX,AL
MOV BL,01H

RUN：
MOV DX,281H    ;跑马灯从左边开始亮起
MOV AL, BL        ;用BL防止死循环
OUT DX, AL


DELAY1:
MOV DX,282H
IN  AL,DX     ;PCO低电平变高电平跳出
AND    AL,01H
CMP AL,01H
JZ DELAY1

DELAY2:
MOV DX,282H
IN  AL,DX
AND,AL,01H        ;PCO高电平变低电平跳出
CMP AL,01H
JNZ DELAY2

ROL BL,1    ；左移循环
JMP RUN

CODE ENDS
END
</code></pre><h1 id="基于8255跑马灯"><a href="#基于8255跑马灯" class="headerlink" title="基于8255跑马灯"></a>基于8255跑马灯</h1><pre><code>PORT_A EQU 280H
PORT_B EQU 281H
PORT_C EQU 282H
PORT_CRL EQU 283H

CODE SEGEMENT
ASSUME CS:CODE

MOV AL,89H
MOV DX,PORT_CRL
OUT DX,AL
MOV AL,O1H

RUN:
MOV DX,PORT_A
OUT DX,AL
ROL AL,1    ；左移
MOV BX,20  ；速度

DELAY:
MOV CX,0FFFFH    ；循环
DELAY1: 
LOOP DELAY
DEC BX
JNZ DELAY
JMP RUN

CODE ENDS
END
</code></pre><h1 id="四成四回显键盘"><a href="#四成四回显键盘" class="headerlink" title="四成四回显键盘"></a>四成四回显键盘</h1><p>1.检查键是否都松开<br>2.检查是否有键压下<br>3.有键压下消除抖动<br>4.编码压下的键，转换成16进制码确定哪个键被压下<br>5.释放键重复2步骤</p>
<pre><code>；端口地址
PORT_A EQU OFF9H
PORT_B EQU OFFBH
PORT_CTL EQU OFFFH
;数据段，键盘扫描码表
DATA    SEGMENT
;            0    1    2    3    4    5    6    7
TABLE    DB    77H,7BH,7DH,7EH,0B7H,0BBH,0BDH,0BEH
        8    9    A    B    C    D    E    F
    DB    0D7H,0DBH,0DDH,0DEH,0E7H,0EBH,0EDH,0EEH
TABLE1      DB 3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH,6FH,77H,7CH
       DB 39h,5EH,79h,71h,0ffh   ;LED段码表，0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f
;堆栈段
STACK    SEGMENT    STACK
    DW 50    DUP(0)
TOP_STACK    LABEL    WORD
STACK    ENDS
;代码段
CODE    SEGMENT
ASSUME    CS:CODE,DS:DATA,SS:STACK
START:    
MOV AX,STACK
MOV SS,AX
LEA SP,TOP_STACK
MOV    AX,DATA
MOV DS,AX

;初始化8255A，方式0，A口输出，B口和C口输入
MOV    DX,PORT_CTL
MOV AL,10001011B
OUT DX,AL

;向所有行送0
SEND:
MOV DX,PORT_A
MOV AL,00H
OUT DX,AL

;读列，查看是否有键松开
MOV DX,PORT_B
WAIT_OPEN:
IN    AL,DX
AND    AL,0FH
CMP    AL,0FH
JNE    WAIT_OPEN

;各键已松开，查列是否有0，是否有键压下
WAIT_PRES:
IN    AL,DX
AND    AL,OFH
CMP    AL,0FH
JE    WAIT_PRES

;有键压下，延时20ms,消除抖动
MOV    CX,16EAH
DELAY:    LOOP DELAY

;查看列，键是否仍被压着
IN    AL,DX
AND    AL.0FH
CMP    AL,0FH
JE    WAIT_PRES

;键仍被压着,确定哪一个键被压下
MOV AL,0FEH ;D0=0
MOC    CL,AL

NETX_ROW:
MOV    DX,PORT_A
OUT    DX,AL
MOV DX,PORT_B
IN    AL,DX
AND    AL,0FH
CMP    AL,0FH
JNE    ENCODE
ROL CL,01
MOV    AL,CL
JMP    NEXT_ROW

ENCODE:
MOV BX,OOOFH
IN    AL,DX

NETX_TRY:
CMP    AL,TABLE[BX]
JE    DONE
DEC BX
JNS    NETX_TRY
MOV    AH,01
JMP    EXIT

DONE:
CMP    AL,TABLE1[BX]
MOV    DX,282H
OUT    DX,AL
JMP    SEND

EIXT:    HLT
CODE    ENDS
END
</code></pre>
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="王嘉熙 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="王嘉熙 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/18/后期PS/" rel="next" title="摄影后期干货">
                <i class="fa fa-chevron-left"></i> 摄影后期干货
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="王嘉熙" />
            
              <p class="site-author-name" itemprop="name">王嘉熙</p>
              <p class="site-description motion-element" itemprop="description">Nothing is impossible</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/08163182" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:wjx15896427883@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/Jason_wang9527" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/jason_wang9527" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#显示一段以-结尾字符串"><span class="nav-number">1.</span> <span class="nav-text">显示一段以$结尾字符串</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实现加法运算"><span class="nav-number">2.</span> <span class="nav-text">实现加法运算</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8255控制LED灯"><span class="nav-number">3.</span> <span class="nav-text">8255控制LED灯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基于8253和8255的跑马灯"><span class="nav-number">4.</span> <span class="nav-text">基于8253和8255的跑马灯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基于8255跑马灯"><span class="nav-number">5.</span> <span class="nav-text">基于8255跑马灯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四成四回显键盘"><span class="nav-number">6.</span> <span class="nav-text">四成四回显键盘</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王嘉熙</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4
<span>   |   </span>
<span id="showDays"></span>
</div>




<script>
  var seconds = 1000;
  var minutes = seconds * 60;
  var hours = minutes * 60;
  var days = hours * 24;
  var years = days * 365;
  var birthDay = Date.UTC(2018,02,10,00,00,00); // 这里设置建站时间
  setInterval(function() {
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    var now = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = now - birthDay;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      document.getElementById('showDays').innerHTML="博客已运行 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
  }, 1000);
</script>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("s8OK1yas4CmWRhxmuW1FJq2Q-gzGzoHsz", "uY78z9PJL2vdt76Nv08OYE3R");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>

<!-- 页面点击小心心 -->
<script type="text/javascript" src="/js/src/love.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css">

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript">
  $(function() {
    hljs.initHighlighting();
    $('pre code').each(function() {
      var lines = $(this).text().split('\n').length - 1;
      var $numbering = $('<ul/>').addClass('pre-numbering');
      $(this)
        .addClass('has-numbering')
        .parent()
        .append($numbering);
      for (i = 1; i <= lines; i++) {
        $numbering.append($('<li/>'));
      }
    });
  });

</script>

<style>
  pre {
    position: relative;
    padding: 0;
  }

  code.has-numbering {
    margin-left: 2.5rem;
  }

  code.has-numbering::-webkit-scrollbar {
    display: none;
  }

  .pre-numbering {
    margin: 0;
    position: absolute;
    top: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: 100%;
  }

  .pre-numbering li {
    list-style-type: decimal-leading-zero !important;
  }

  @media (max-width: 760px) {
    .post-body pre {
      padding: 0px;
    }

    .post-body .pre-numbering {
      display: none;
    }

    code.has-numbering {
      margin: 0;
    }
  }

</style>

</html>
